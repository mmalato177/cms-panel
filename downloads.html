<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Downloads – DSR24 CMS Panel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/sidebar.js" defer></script>
    <script src="/js/loadPartials.js" defer></script>

</head>

<body>

    <div class="container-fluid">
        <div class="row">

            <!-- SIDEBAR -->
            <div id="sidebar"></div>

            <!-- MAIN CONTENT -->
            <main id="main" class="col-12 col-md-10 bg-light">
                <div class="dashboard-content">
                    <button class="openbtn" onclick="openNav()">&#9776; Open Sidebar</button>

                    <!-- Page Header -->
                    <section class="page-header">
                        <div class="page-header-content">
                            <div class="page-header-text">
                                <h2 class="fw-bold">Downloads Repository</h2>
                                <p>Manage downloadable files like PDFs, brochures, and documents across all websites.</p>
                            </div>
                            <button class="btn btn-primary btn-create" data-bs-toggle="modal" data-bs-target="#uploadDownloadModal">
                                <i class="bi bi-cloud-upload"></i> Upload File
                            </button>
                        </div>
                    </section>

                    <!-- Stats Cards -->
                    <section class="downloads-stats">
                        <div class="row g-3">
                            <div class="col-md-3">
                                <div class="stat-card stat-card-blue">
                                    <div class="stat-icon">
                                        <i class="bi bi-folder"></i>
                                    </div>
                                    <div class="stat-info">
                                        <p class="stat-value" id="statTotalFiles">0</p>
                                        <p class="stat-label">Total Files</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stat-card stat-card-red">
                                    <div class="stat-icon">
                                        <i class="bi bi-file-earmark-pdf"></i>
                                    </div>
                                    <div class="stat-info">
                                        <p class="stat-value" id="statPdfs">0</p>
                                        <p class="stat-label">PDF Documents</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stat-card stat-card-green">
                                    <div class="stat-icon">
                                        <i class="bi bi-hdd"></i>
                                    </div>
                                    <div class="stat-info">
                                        <p class="stat-value" id="statStorage">0 MB</p>
                                        <p class="stat-label">Storage Used</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stat-card stat-card-orange">
                                    <div class="stat-icon">
                                        <i class="bi bi-download"></i>
                                    </div>
                                    <div class="stat-info">
                                        <p class="stat-value" id="statDownloads">0</p>
                                        <p class="stat-label">Downloads This Month</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Filters -->
                    <section class="downloads-filters">
                        <div class="filters-row">
                            <div class="filter-tabs">
                                <button class="filter-tab active">All <span class="badge" id="filterAll">0</span></button>
                                <button class="filter-tab">PDFs <span class="badge" id="filterPdfs">0</span></button>
                                <button class="filter-tab">Documents <span class="badge" id="filterDocs">0</span></button>
                                <button class="filter-tab">Spreadsheets <span class="badge" id="filterSheets">0</span></button>
                            </div>
                            <div class="filter-actions">
                                <div class="filter-search">
                                    <i class="bi bi-search"></i>
                                    <input type="text" placeholder="Search downloads..." id="downloadSearch">
                                </div>
                                <div class="view-toggle">
                                    <button class="view-btn active" data-view="grid" title="Grid View">
                                        <i class="bi bi-grid-3x3-gap"></i>
                                    </button>
                                    <button class="view-btn" data-view="list" title="List View">
                                        <i class="bi bi-list-ul"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Downloads Grid -->
                    <section class="downloads-grid-section">
                        <div class="downloads-grid" id="downloadsGrid">
                            <!-- PDF 1 -->
                            <div class="download-item" data-type="pdf" data-id="5001" data-filename="DSR24_Company_Brochure_2026.pdf" data-title="DSR24 Company Brochure 2026" data-description="Official company brochure with services overview" data-size="2.4 MB" data-date="2026-01-15" data-downloads="156" data-category="Marketing">
                                <div class="download-thumbnail">
                                    <div class="file-icon file-icon-pdf">
                                        <i class="bi bi-file-earmark-pdf-fill"></i>
                                    </div>
                                    <div class="download-overlay">
                                        <button class="overlay-btn btn-download-file" title="Download"><i class="bi bi-download"></i></button>
                                        <button class="overlay-btn btn-edit-download" title="Edit" data-bs-toggle="modal" data-bs-target="#editDownloadModal"><i class="bi bi-pencil"></i></button>
                                    </div>
                                </div>
                                <div class="download-info">
                                    <p class="download-title">DSR24 Company Brochure 2026</p>
                                    <div class="download-meta">
                                        <span class="meta-size">2.4 MB</span>
                                        <span class="meta-downloads"><i class="bi bi-download"></i> 156</span>
                                    </div>
                                </div>
                            </div>

                            <!-- PDF 2 -->
                            <div class="download-item" data-type="pdf" data-id="5002" data-filename="Kfz_Gutachten_Leitfaden.pdf" data-title="Kfz-Gutachten Leitfaden" data-description="Comprehensive guide for vehicle damage assessment" data-size="1.8 MB" data-date="2026-02-01" data-downloads="89" data-category="Guides">
                                <div class="download-thumbnail">
                                    <div class="file-icon file-icon-pdf">
                                        <i class="bi bi-file-earmark-pdf-fill"></i>
                                    </div>
                                    <div class="download-overlay">
                                        <button class="overlay-btn btn-download-file" title="Download"><i class="bi bi-download"></i></button>
                                        <button class="overlay-btn btn-edit-download" title="Edit" data-bs-toggle="modal" data-bs-target="#editDownloadModal"><i class="bi bi-pencil"></i></button>
                                    </div>
                                </div>
                                <div class="download-info">
                                    <p class="download-title">Kfz-Gutachten Leitfaden</p>
                                    <div class="download-meta">
                                        <span class="meta-size">1.8 MB</span>
                                        <span class="meta-downloads"><i class="bi bi-download"></i> 89</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Word Document -->
                            <div class="download-item" data-type="doc" data-id="5003" data-filename="Schadensmeldung_Formular.docx" data-title="Schadensmeldung Formular" data-description="Fillable damage report form template" data-size="245 KB" data-date="2026-01-20" data-downloads="234" data-category="Forms">
                                <div class="download-thumbnail">
                                    <div class="file-icon file-icon-doc">
                                        <i class="bi bi-file-earmark-word-fill"></i>
                                    </div>
                                    <div class="download-overlay">
                                        <button class="overlay-btn btn-download-file" title="Download"><i class="bi bi-download"></i></button>
                                        <button class="overlay-btn btn-edit-download" title="Edit" data-bs-toggle="modal" data-bs-target="#editDownloadModal"><i class="bi bi-pencil"></i></button>
                                    </div>
                                </div>
                                <div class="download-info">
                                    <p class="download-title">Schadensmeldung Formular</p>
                                    <div class="download-meta">
                                        <span class="meta-size">245 KB</span>
                                        <span class="meta-downloads"><i class="bi bi-download"></i> 234</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Excel Spreadsheet -->
                            <div class="download-item" data-type="xls" data-id="5004" data-filename="Reparaturkosten_Kalkulator.xlsx" data-title="Reparaturkosten Kalkulator" data-description="Excel calculator for repair cost estimation" data-size="156 KB" data-date="2026-02-05" data-downloads="67" data-category="Tools">
                                <div class="download-thumbnail">
                                    <div class="file-icon file-icon-xls">
                                        <i class="bi bi-file-earmark-excel-fill"></i>
                                    </div>
                                    <div class="download-overlay">
                                        <button class="overlay-btn btn-download-file" title="Download"><i class="bi bi-download"></i></button>
                                        <button class="overlay-btn btn-edit-download" title="Edit" data-bs-toggle="modal" data-bs-target="#editDownloadModal"><i class="bi bi-pencil"></i></button>
                                    </div>
                                </div>
                                <div class="download-info">
                                    <p class="download-title">Reparaturkosten Kalkulator</p>
                                    <div class="download-meta">
                                        <span class="meta-size">156 KB</span>
                                        <span class="meta-downloads"><i class="bi bi-download"></i> 67</span>
                                    </div>
                                </div>
                            </div>

                            <!-- PDF 3 -->
                            <div class="download-item" data-type="pdf" data-id="5005" data-filename="AGB_DSR24_2026.pdf" data-title="AGB DSR24 2026" data-description="Terms and conditions for DSR24 services" data-size="520 KB" data-date="2026-01-01" data-downloads="45" data-category="Legal">
                                <div class="download-thumbnail">
                                    <div class="file-icon file-icon-pdf">
                                        <i class="bi bi-file-earmark-pdf-fill"></i>
                                    </div>
                                    <div class="download-overlay">
                                        <button class="overlay-btn btn-download-file" title="Download"><i class="bi bi-download"></i></button>
                                        <button class="overlay-btn btn-edit-download" title="Edit" data-bs-toggle="modal" data-bs-target="#editDownloadModal"><i class="bi bi-pencil"></i></button>
                                    </div>
                                </div>
                                <div class="download-info">
                                    <p class="download-title">AGB DSR24 2026</p>
                                    <div class="download-meta">
                                        <span class="meta-size">520 KB</span>
                                        <span class="meta-downloads"><i class="bi bi-download"></i> 45</span>
                                    </div>
                                </div>
                            </div>

                            <!-- PDF 4 -->
                            <div class="download-item" data-type="pdf" data-id="5006" data-filename="Datenschutzerklaerung.pdf" data-title="Datenschutzerklärung" data-description="Privacy policy document" data-size="380 KB" data-date="2026-01-01" data-downloads="112" data-category="Legal">
                                <div class="download-thumbnail">
                                    <div class="file-icon file-icon-pdf">
                                        <i class="bi bi-file-earmark-pdf-fill"></i>
                                    </div>
                                    <div class="download-overlay">
                                        <button class="overlay-btn btn-download-file" title="Download"><i class="bi bi-download"></i></button>
                                        <button class="overlay-btn btn-edit-download" title="Edit" data-bs-toggle="modal" data-bs-target="#editDownloadModal"><i class="bi bi-pencil"></i></button>
                                    </div>
                                </div>
                                <div class="download-info">
                                    <p class="download-title">Datenschutzerklärung</p>
                                    <div class="download-meta">
                                        <span class="meta-size">380 KB</span>
                                        <span class="meta-downloads"><i class="bi bi-download"></i> 112</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Word Document 2 -->
                            <div class="download-item" data-type="doc" data-id="5007" data-filename="Bewerbung_Vorlage.docx" data-title="Bewerbung Vorlage" data-description="Job application template" data-size="185 KB" data-date="2026-01-25" data-downloads="78" data-category="HR">
                                <div class="download-thumbnail">
                                    <div class="file-icon file-icon-doc">
                                        <i class="bi bi-file-earmark-word-fill"></i>
                                    </div>
                                    <div class="download-overlay">
                                        <button class="overlay-btn btn-download-file" title="Download"><i class="bi bi-download"></i></button>
                                        <button class="overlay-btn btn-edit-download" title="Edit" data-bs-toggle="modal" data-bs-target="#editDownloadModal"><i class="bi bi-pencil"></i></button>
                                    </div>
                                </div>
                                <div class="download-info">
                                    <p class="download-title">Bewerbung Vorlage</p>
                                    <div class="download-meta">
                                        <span class="meta-size">185 KB</span>
                                        <span class="meta-downloads"><i class="bi bi-download"></i> 78</span>
                                    </div>
                                </div>
                            </div>

                            <!-- PDF 5 -->
                            <div class="download-item" data-type="pdf" data-id="5008" data-filename="Preisliste_Sachverstaendiger_2026.pdf" data-title="Preisliste Sachverständiger 2026" data-description="Price list for expert services" data-size="890 KB" data-date="2026-02-08" data-downloads="203" data-category="Pricing">
                                <div class="download-thumbnail">
                                    <div class="file-icon file-icon-pdf">
                                        <i class="bi bi-file-earmark-pdf-fill"></i>
                                    </div>
                                    <div class="download-overlay">
                                        <button class="overlay-btn btn-download-file" title="Download"><i class="bi bi-download"></i></button>
                                        <button class="overlay-btn btn-edit-download" title="Edit" data-bs-toggle="modal" data-bs-target="#editDownloadModal"><i class="bi bi-pencil"></i></button>
                                    </div>
                                </div>
                                <div class="download-info">
                                    <p class="download-title">Preisliste Sachverständiger 2026</p>
                                    <div class="download-meta">
                                        <span class="meta-size">890 KB</span>
                                        <span class="meta-downloads"><i class="bi bi-download"></i> 203</span>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </section>

                </div>
            </main>

        </div>
    </div>

    <!-- Upload Download Modal -->
    <div class="modal fade" id="uploadDownloadModal" tabindex="-1" aria-labelledby="uploadDownloadModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="uploadDownloadModalLabel">
                        <i class="bi bi-cloud-upload"></i> Upload New File
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form class="download-form" id="uploadDownloadForm">
                        <!-- Drop Zone -->
                        <div class="upload-dropzone" id="dropZone">
                            <i class="bi bi-cloud-arrow-up"></i>
                            <p>Drag & drop files here or <span class="browse-link">browse</span></p>
                            <p class="upload-hint">Supported formats: PDF, DOCX, XLSX, TXT, ZIP (Max 25MB)</p>
                            <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.xls,.xlsx,.txt,.zip" hidden>
                        </div>

                        <!-- Upload Preview -->
                        <div class="upload-preview" id="uploadPreview" style="display: none;">
                            <div class="preview-item">
                                <div class="preview-file-icon" id="previewIcon">
                                    <i class="bi bi-file-earmark"></i>
                                </div>
                                <div class="preview-info">
                                    <p class="preview-filename" id="previewFilename"></p>
                                    <p class="preview-size" id="previewSize"></p>
                                </div>
                                <button type="button" class="btn-remove-preview" onclick="removeUploadPreview()"><i class="bi bi-x-lg"></i></button>
                            </div>
                        </div>

                        <hr>

                        <div class="row g-3">
                            <!-- Title DE -->
                            <div class="col-md-6">
                                <label class="form-label">Title (German)</label>
                                <input type="text" class="form-control" id="upload-title-de" placeholder="Titel des Dokuments...">
                            </div>
                            <!-- Title EN -->
                            <div class="col-md-6">
                                <label class="form-label">Title (English)</label>
                                <input type="text" class="form-control" id="upload-title-en" placeholder="Document title...">
                            </div>

                            <!-- Description DE -->
                            <div class="col-md-6">
                                <label class="form-label">Description (German)</label>
                                <textarea class="form-control" rows="2" id="upload-desc-de" placeholder="Optionale Beschreibung..."></textarea>
                            </div>
                            <!-- Description EN -->
                            <div class="col-md-6">
                                <label class="form-label">Description (English)</label>
                                <textarea class="form-control" rows="2" id="upload-desc-en" placeholder="Optional description..."></textarea>
                            </div>

                            <!-- Category -->
                            <div class="col-md-6">
                                <label class="form-label">Category</label>
                                <select class="form-select" id="upload-category">
                                    <option value="">Select category...</option>
                                    <option value="Marketing">Marketing</option>
                                    <option value="Legal">Legal</option>
                                    <option value="Guides">Guides</option>
                                    <option value="Forms">Forms</option>
                                    <option value="Tools">Tools</option>
                                    <option value="HR">HR</option>
                                    <option value="Pricing">Pricing</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>

                            <!-- Internal Comments -->
                            <div class="col-md-6">
                                <label class="form-label">Internal Notes <span class="text-muted">(CMS only)</span></label>
                                <input type="text" class="form-control" id="upload-internal" placeholder="Internal notes...">
                            </div>

                            <!-- Publish On Sites -->
                            <div class="col-12">
                                <label class="form-label">Publish on Websites</label>
                                <div class="sites-checkboxes">
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox" id="upload-site-dsr24" checked>
                                        <label class="form-check-label" for="upload-site-dsr24">dsr24.de</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox" id="upload-site-kfzvs">
                                        <label class="form-check-label" for="upload-site-kfzvs">kfzvs.de</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox" id="upload-site-dsgutachten">
                                        <label class="form-check-label" for="upload-site-dsgutachten">dsgutachten.de</label>
                                    </div>
                                </div>
                            </div>

                            <!-- noindex -->
                            <div class="col-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="upload-noindex">
                                    <label class="form-check-label" for="upload-noindex">
                                        <strong>noindex</strong> - Prevent search engines from indexing this file
                                    </label>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="uploadDownload()">
                        <i class="bi bi-cloud-upload"></i> Upload
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Download Modal -->
    <div class="modal fade" id="editDownloadModal" tabindex="-1" aria-labelledby="editDownloadModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editDownloadModalLabel">
                        <i class="bi bi-pencil"></i> Edit Download
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form class="download-form" id="editDownloadForm">
                        <!-- File Info Row -->
                        <div class="edit-download-info">
                            <div class="edit-file-icon" id="editFileIcon">
                                <i class="bi bi-file-earmark-pdf-fill"></i>
                            </div>
                            <div class="edit-file-details">
                                <p class="edit-filename" id="editFilename"></p>
                                <p class="edit-meta">
                                    <span id="editSize"></span> • 
                                    <span id="editType"></span> • 
                                    <span id="editDownloadCount"></span> downloads
                                </p>
                                <p class="edit-meta text-muted">
                                    Uploaded: <span id="editDate"></span> • 
                                    ID: <span id="editId"></span>
                                </p>
                                <p class="edit-seo-url" id="editSeoUrl"></p>
                            </div>
                        </div>

                        <hr>

                        <div class="row g-3">
                            <!-- Title DE -->
                            <div class="col-md-6">
                                <label class="form-label">Title (German)</label>
                                <input type="text" class="form-control" id="edit-title-de">
                            </div>
                            <!-- Title EN -->
                            <div class="col-md-6">
                                <label class="form-label">Title (English)</label>
                                <input type="text" class="form-control" id="edit-title-en">
                            </div>

                            <!-- Description DE -->
                            <div class="col-md-6">
                                <label class="form-label">Description (German)</label>
                                <textarea class="form-control" rows="2" id="edit-desc-de"></textarea>
                            </div>
                            <!-- Description EN -->
                            <div class="col-md-6">
                                <label class="form-label">Description (English)</label>
                                <textarea class="form-control" rows="2" id="edit-desc-en"></textarea>
                            </div>

                            <!-- Category -->
                            <div class="col-md-6">
                                <label class="form-label">Category</label>
                                <select class="form-select" id="edit-category">
                                    <option value="">Select category...</option>
                                    <option value="Marketing">Marketing</option>
                                    <option value="Legal">Legal</option>
                                    <option value="Guides">Guides</option>
                                    <option value="Forms">Forms</option>
                                    <option value="Tools">Tools</option>
                                    <option value="HR">HR</option>
                                    <option value="Pricing">Pricing</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>

                            <!-- Internal Notes -->
                            <div class="col-md-6">
                                <label class="form-label">Internal Notes <span class="text-muted">(CMS only)</span></label>
                                <input type="text" class="form-control" id="edit-internal">
                            </div>

                            <!-- Publish On Sites -->
                            <div class="col-12">
                                <label class="form-label">Publish on Websites</label>
                                <div class="sites-checkboxes">
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox" id="edit-site-dsr24">
                                        <label class="form-check-label" for="edit-site-dsr24">dsr24.de</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox" id="edit-site-kfzvs">
                                        <label class="form-check-label" for="edit-site-kfzvs">kfzvs.de</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox" id="edit-site-dsgutachten">
                                        <label class="form-check-label" for="edit-site-dsgutachten">dsgutachten.de</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Replace File -->
                            <div class="col-12">
                                <label class="form-label">Replace File</label>
                                <div class="replace-file-area">
                                    <button type="button" class="btn btn-outline-secondary" onclick="document.getElementById('replaceFileInput').click()">
                                        <i class="bi bi-arrow-repeat"></i> Upload New Version
                                    </button>
                                    <span class="replace-hint">Upload a new file to replace the current one</span>
                                    <input type="file" id="replaceFileInput" accept=".pdf,.doc,.docx,.xls,.xlsx,.txt,.zip" hidden>
                                </div>
                            </div>

                            <!-- noindex -->
                            <div class="col-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="edit-noindex">
                                    <label class="form-check-label" for="edit-noindex">
                                        <strong>noindex</strong> - Prevent search engines from indexing this file
                                    </label>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger me-auto" onclick="deleteDownload()">
                        <i class="bi bi-trash"></i> Delete
                    </button>
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveDownload()">
                        <i class="bi bi-check-lg"></i> Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-exclamation-triangle"></i> Delete File
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to permanently delete this file?</p>
                    <p class="mb-0"><strong id="delete-file-title"></strong></p>
                    <p class="text-danger small mt-2">
                        <i class="bi bi-exclamation-circle"></i> This action cannot be undone. The file will be removed from all websites where it's linked.
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="confirmDelete()">
                        <i class="bi bi-trash"></i> Delete Permanently
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Toast -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="successToast" class="toast" role="alert">
            <div class="toast-header bg-success text-white">
                <i class="bi bi-check-circle me-2"></i>
                <strong class="me-auto">Success</strong>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                Operation completed successfully.
            </div>
        </div>
    </div>

    <script>
        let currentEditItem = null;
        let currentDeleteItem = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initDropZone();
            initDownloadItems();
            initFilters();
            initViewToggle();
            updateStats();
        });

        // Drag & Drop Zone
        function initDropZone() {
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('fileInput');

            dropZone.addEventListener('click', () => fileInput.click());
            
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });

            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('dragover');
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            });

            fileInput.addEventListener('change', (e) => {
                handleFiles(e.target.files);
            });
        }

        function handleFiles(files) {
            if (files.length === 0) return;
            
            const file = files[0];
            const preview = document.getElementById('uploadPreview');
            const previewIcon = document.getElementById('previewIcon');
            const previewFilename = document.getElementById('previewFilename');
            const previewSize = document.getElementById('previewSize');

            // Set icon based on file type
            const ext = file.name.split('.').pop().toLowerCase();
            let iconClass = 'bi-file-earmark';
            if (ext === 'pdf') iconClass = 'bi-file-earmark-pdf-fill';
            else if (['doc', 'docx'].includes(ext)) iconClass = 'bi-file-earmark-word-fill';
            else if (['xls', 'xlsx'].includes(ext)) iconClass = 'bi-file-earmark-excel-fill';
            else if (ext === 'zip') iconClass = 'bi-file-earmark-zip-fill';
            else if (ext === 'txt') iconClass = 'bi-file-earmark-text-fill';

            previewIcon.innerHTML = `<i class="bi ${iconClass}"></i>`;
            previewFilename.textContent = file.name;
            previewSize.textContent = formatFileSize(file.size);
            preview.style.display = 'block';
            document.getElementById('dropZone').style.display = 'none';

            // Auto-fill title from filename
            const titleFromFile = file.name.replace(/\.[^/.]+$/, '').replace(/_/g, ' ');
            document.getElementById('upload-title-de').value = titleFromFile;
            document.getElementById('upload-title-en').value = titleFromFile;
        }

        function removeUploadPreview() {
            document.getElementById('uploadPreview').style.display = 'none';
            document.getElementById('dropZone').style.display = '';
            document.getElementById('fileInput').value = '';
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        // Download Items Interaction
        function initDownloadItems() {
            // Edit buttons
            document.querySelectorAll('.btn-edit-download').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const item = this.closest('.download-item');
                    currentEditItem = item;
                    populateEditModal(item);
                });
            });

            // Download buttons
            document.querySelectorAll('.btn-download-file').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const item = this.closest('.download-item');
                    simulateDownload(item);
                });
            });
        }

        function populateEditModal(item) {
            const type = item.dataset.type;
            const editIcon = document.getElementById('editFileIcon');
            
            // Set icon based on type
            let iconClass = 'bi-file-earmark';
            if (type === 'pdf') iconClass = 'bi-file-earmark-pdf-fill';
            else if (type === 'doc') iconClass = 'bi-file-earmark-word-fill';
            else if (type === 'xls') iconClass = 'bi-file-earmark-excel-fill';
            
            editIcon.innerHTML = `<i class="bi ${iconClass}"></i>`;
            editIcon.className = `edit-file-icon file-icon-${type}`;

            document.getElementById('editFilename').textContent = item.dataset.filename;
            document.getElementById('editSize').textContent = item.dataset.size;
            document.getElementById('editType').textContent = type.toUpperCase();
            document.getElementById('editDownloadCount').textContent = item.dataset.downloads;
            document.getElementById('editDate').textContent = item.dataset.date;
            document.getElementById('editId').textContent = item.dataset.id;
            
            // SEO URL
            const slug = item.dataset.title.toLowerCase()
                .replace(/[^a-z0-9\s]/g, '')
                .replace(/\s+/g, '-')
                .substring(0, 50);
            document.getElementById('editSeoUrl').textContent = `/downloads/${slug}-${item.dataset.id}.${type}`;

            document.getElementById('edit-title-en').value = item.dataset.title;
            document.getElementById('edit-desc-en').value = item.dataset.description || '';
            document.getElementById('edit-category').value = item.dataset.category || '';
            
            // Default to dsr24.de checked
            document.getElementById('edit-site-dsr24').checked = true;
        }

        function simulateDownload(item) {
            // Increment download count
            let count = parseInt(item.dataset.downloads) || 0;
            count++;
            item.dataset.downloads = count;
            item.querySelector('.meta-downloads').innerHTML = `<i class="bi bi-download"></i> ${count}`;
            
            showToast(`Downloading: ${item.dataset.filename}`);
            updateStats();
        }

        // Filter functionality
        function initFilters() {
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    const filter = this.textContent.trim().toLowerCase();
                    document.querySelectorAll('.download-item').forEach(item => {
                        if (filter.startsWith('all')) {
                            item.style.display = '';
                        } else if (filter.startsWith('pdf')) {
                            item.style.display = item.dataset.type === 'pdf' ? '' : 'none';
                        } else if (filter.startsWith('doc')) {
                            item.style.display = item.dataset.type === 'doc' ? '' : 'none';
                        } else if (filter.startsWith('spread')) {
                            item.style.display = item.dataset.type === 'xls' ? '' : 'none';
                        }
                    });
                });
            });

            // Search
            document.getElementById('downloadSearch').addEventListener('input', function() {
                const search = this.value.toLowerCase();
                document.querySelectorAll('.download-item').forEach(item => {
                    const text = (item.dataset.title + ' ' + item.dataset.filename + ' ' + item.dataset.description + ' ' + item.dataset.category).toLowerCase();
                    item.style.display = text.includes(search) ? '' : 'none';
                });
            });
        }

        // View toggle
        function initViewToggle() {
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const grid = document.getElementById('downloadsGrid');
                    if (this.dataset.view === 'list') {
                        grid.classList.add('list-view');
                    } else {
                        grid.classList.remove('list-view');
                    }
                });
            });
        }

        // Save download
        function saveDownload() {
            if (!currentEditItem) return;

            // Update data attributes
            currentEditItem.dataset.title = document.getElementById('edit-title-en').value;
            currentEditItem.dataset.description = document.getElementById('edit-desc-en').value;
            currentEditItem.dataset.category = document.getElementById('edit-category').value;

            // Update visible title
            currentEditItem.querySelector('.download-title').textContent = document.getElementById('edit-title-en').value;

            bootstrap.Modal.getInstance(document.getElementById('editDownloadModal')).hide();
            showToast('File metadata updated successfully!');
        }

        // Delete download
        function deleteDownload() {
            currentDeleteItem = currentEditItem;
            document.getElementById('delete-file-title').textContent = currentEditItem.dataset.title;
            
            bootstrap.Modal.getInstance(document.getElementById('editDownloadModal')).hide();
            const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
            deleteModal.show();
        }

        function confirmDelete() {
            if (!currentDeleteItem) return;
            
            currentDeleteItem.style.transition = 'opacity 0.3s, transform 0.3s';
            currentDeleteItem.style.opacity = '0';
            currentDeleteItem.style.transform = 'scale(0.8)';
            
            setTimeout(() => {
                currentDeleteItem.remove();
                updateStats();
            }, 300);

            bootstrap.Modal.getInstance(document.getElementById('deleteModal')).hide();
            showToast('File deleted successfully!');
        }

        // Upload download
        function uploadDownload() {
            const preview = document.getElementById('uploadPreview');
            if (preview.style.display === 'none') {
                alert('Please select a file to upload.');
                return;
            }

            bootstrap.Modal.getInstance(document.getElementById('uploadDownloadModal')).hide();
            
            // Reset form
            preview.style.display = 'none';
            document.getElementById('dropZone').style.display = '';
            document.getElementById('uploadDownloadForm').reset();
            
            showToast('File uploaded successfully!');
            updateStats();
        }

        // Update stats
        function updateStats() {
            const allItems = document.querySelectorAll('.download-item');
            const pdfs = document.querySelectorAll('.download-item[data-type="pdf"]').length;
            const docs = document.querySelectorAll('.download-item[data-type="doc"]').length;
            const sheets = document.querySelectorAll('.download-item[data-type="xls"]').length;
            const total = allItems.length;
            
            // Calculate total storage from data-size attributes
            let totalBytes = 0;
            allItems.forEach(item => {
                const sizeStr = item.dataset.size || '0';
                const size = parseFloat(sizeStr);
                if (sizeStr.includes('GB')) {
                    totalBytes += size * 1024 * 1024 * 1024;
                } else if (sizeStr.includes('MB')) {
                    totalBytes += size * 1024 * 1024;
                } else if (sizeStr.includes('KB')) {
                    totalBytes += size * 1024;
                }
            });
            
            // Format storage
            let storageStr;
            if (totalBytes >= 1024 * 1024 * 1024) {
                storageStr = (totalBytes / (1024 * 1024 * 1024)).toFixed(2) + ' GB';
            } else {
                storageStr = (totalBytes / (1024 * 1024)).toFixed(1) + ' MB';
            }
            
            // Calculate total downloads
            let totalDownloads = 0;
            allItems.forEach(item => {
                totalDownloads += parseInt(item.dataset.downloads) || 0;
            });
            
            // Update stats cards
            document.getElementById('statTotalFiles').textContent = total;
            document.getElementById('statPdfs').textContent = pdfs;
            document.getElementById('statStorage').textContent = storageStr;
            document.getElementById('statDownloads').textContent = totalDownloads;
            
            // Update filter badges
            document.getElementById('filterAll').textContent = total;
            document.getElementById('filterPdfs').textContent = pdfs;
            document.getElementById('filterDocs').textContent = docs;
            document.getElementById('filterSheets').textContent = sheets;
        }

        // Show toast
        function showToast(message) {
            document.getElementById('toastMessage').textContent = message;
            const toast = new bootstrap.Toast(document.getElementById('successToast'));
            toast.show();
        }
    </script>

</body>

</html>
